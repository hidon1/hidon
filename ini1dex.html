<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title></title>
  <style>
    body {
      visibility: hidden; /* 住转专 注 砖住拽专驻 注  */
      margin: 0;
      overflow: hidden; /* 注  注转 */
    }
  </style>

  <link rel="stylesheet" href="mobile_friendly_style_with_comment.css">
  <link href="https://fonts.googleapis.com/css2?family=Alef:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Rubik+Dirt:wght@400&display=swap" rel="stylesheet">
</head>
<body>
  <div id="welcomeBanner" class="banner hide">
    <div class="banner-content">
      <p></p>
      <button id="loginButton" class="auth-button">转专/专砖</button>
      <button id="continueWithoutLogin" class="auth-button">砖  转专转</button>
    </div>
  </div>

  <div id="authOverlay" class="overlay">
    <div class="auth-box">
      <h2>转专转 / 专砖</h2>
      <div id="loginForm">
        <h3>转专</h3>
        <input type="email" id="loginEmail" placeholder="">
        <input type="password" id="loginPassword" placeholder="住住">
        <button id="loginSubmit">转专</button>
        <p>  砖? <a href="#" id="signupLink">专砖 </a></p>
      </div>
      <div id="signupForm" style="display: none;">
        <h3>专砖</h3>
        <input type="email" id="signupEmail" placeholder="">
        <input type="password" id="signupPassword" placeholder="住住">
        <button id="signupSubmit">专砖</button>
        <p>专 砖  砖? <a href="#" id="showLoginForm">转专 </a></p>
      </div>
      <button id="closeAuth" class="close-button">&times;</button>
    </div>
  </div>

  <div id="startScreen" class="start-screen">
    <div class="user-info">
      <span id="usernameDisplay">专</span>
      <button id="logoutButton" style="display: none;">转转拽</button>
    </div>
    <h1></h1>
    <p>专  砖拽 !</p>
    <button id="newGameButton">转 砖拽 砖</button>
    <div class="stats-section">
      <button id="showStatsButton">爪 住住拽转</button>
      <button id="resetStatsButton">驻住 住住拽转 拽转</button>
    </div>
  </div>

  <div id="gameStatsOverlay" class="overlay">
    <div class="stats-box">
      <h2>住住拽转 砖拽</h2>
      <p>爪转: <span id="winsCount">0</span></p>
      <p>驻住: <span id="lossesCount">0</span></p>
      <button id="closeStatsButton">住专</button>
    </div>
  </div>

  <div id="gameContainer" class="game-container">
    <div class="header-bar">
      <span class="coins-display"> <span id="coins">0</span></span>
      <span class="stage-display">砖: <span id="stageDisplay">1</span></span>
    </div>
    <div class="game-area">
      <img id="hangmanImage" src="hangman0.png" alt="砖 转">
      <p id="wordDisplay" class="word-display"></p>
      <p id="message" class="message"></p>
      <div id="alphabet" class="alphabet-grid"></div>
      <button id="playAgain" class="play-again-button">砖拽 砖</button>
    </div>
  </div>

  <script type="module">
    // 专转 砖转 
    let coins = 0; // 注转
    let currentWord = ''; //  转
    let guessedLetters = []; // 转转 砖砖
    let mistakes = 0; // 注转 住 
    let maxMistakes = 6; // 拽住 注转
    let totalMistakesInRound = 0; // 住 注转 注转
    let wordList = []; // 专砖转  -JSON
    let currentStage = 0; // 砖 
    let user = null; //  砖砖 驻专住 专注, 专 砖转砖 专
    let wins = 0;
    let losses = 0;

    //  -DOM
    const coinElement = document.getElementById('coins');
    const wordDisplay = document.getElementById('wordDisplay');
    const alphabetContainer = document.getElementById('alphabet');
    const hangmanImage = document.getElementById('hangmanImage');
    const message = document.getElementById('message');
    const playAgainButton = document.getElementById('playAgain');
    const newGameButton = document.getElementById('newGameButton');
    const startScreen = document.getElementById('startScreen');
    const authOverlay = document.getElementById('authOverlay');
    const welcomeBanner = document.getElementById('welcomeBanner');
    const continueWithoutLoginButton = document.getElementById('continueWithoutLogin');
    const loginButton = document.getElementById('loginButton');
    const gameContainer = document.getElementById('gameContainer');
    const logoutButton = document.getElementById('logoutButton');
    const scoreDisplay = document.getElementById('scoreDisplay');
    const stageDisplay = document.getElementById('stageDisplay');
    const gameStatsOverlay = document.getElementById('gameStatsOverlay');
    const closeStatsButton = document.getElementById('closeStatsButton');
    const usernameDisplay = document.getElementById('usernameDisplay');
    const signupLink = document.getElementById('signupLink');
    const loginForm = document.getElementById('loginForm');
    const signupForm = document.getElementById('signupForm');
    const showLoginFormLink = document.getElementById('showLoginForm');
    const showSignupFormLink = document.getElementById('showSignupForm');
    const loginEmailInput = document.getElementById('loginEmail');
    const loginPasswordInput = document.getElementById('loginPassword');
    const signupEmailInput = document.getElementById('signupEmail');
    const signupPasswordInput = document.getElementById('signupPassword');
    const loginSubmitButton = document.getElementById('loginSubmit');
    const signupSubmitButton = document.getElementById('signupSubmit');
    const showStatsButton = document.getElementById('showStatsButton');
    const resetStatsButton = document.getElementById('resetStatsButton');
    const winsCountSpan = document.getElementById('winsCount');
    const lossesCountSpan = document.getElementById('lossesCount');
    const closeAuthButton = document.getElementById('closeAuth');


    // 注转  拽抓 JSON
    fetch('stages.json')
      .then(response => response.json())
      .then(data => {
        wordList = data.stages;
        console.log('Words loaded:', wordList);
        // 爪转 专 驻转 专 注转 
        welcomeBanner.classList.remove('hide');
        document.body.style.visibility = 'visible'; // 爪 转 -body 专 注
        loadLocalStats(); // 注 住住拽转 拽转
      })
      .catch(error => {
        console.error('Error loading words:', error);
        message.textContent = '砖 注转 . 住 专注 转 祝.';
        message.style.color = 'red';
        document.body.style.visibility = 'visible'; //  砖-body   拽专 砖
      });

    // --- 驻拽爪转  注转 住住拽转 ( Firebase) ---

    // 驻拽爪 注 转爪转 注转
    function updateCoinsDisplay() {
      coinElement.textContent = coins;
    }

    // 驻拽爪 注 注转
    function updateCoins(amount) {
      coins += amount;
      if (coins < 0) coins = 0; // 注 注转 砖
      updateCoinsDisplay();
      saveLocalStats(); // 砖专 转 注转 -Local Storage
      console.log('Coins updated locally:', coins);
    }

    // 驻拽爪转 砖专 注 砖 住住拽转 (-Local Storage)
    function saveLocalStats() {
      localStorage.setItem('gameWins', wins);
      localStorage.setItem('gameLosses', losses);
      localStorage.setItem('gameCoins', coins); // 砖专转 注转
      localStorage.setItem('currentStage', currentStage);
    }

    function loadLocalStats() {
      wins = parseInt(localStorage.getItem('gameWins')) || 0;
      losses = parseInt(localStorage.getItem('gameLosses')) || 0;
      coins = parseInt(localStorage.getItem('gameCoins')) || 0; // 注转 注转
      currentStage = parseInt(localStorage.getItem('currentStage')) || 0;
      if (currentStage >= wordList.length && wordList.length > 0) {
        currentStage = 0; // 驻住 砖    
      }
      updateStatsDisplay();
      updateCoinsDisplay();
      stageDisplay.textContent = currentStage + 1; // 转 爪 砖 + 1
    }

    function updateStatsDisplay() {
      winsCountSpan.textContent = wins;
      lossesCountSpan.textContent = losses;
    }

    function resetLocalStats() {
      if (confirm(' 转  砖专爪 驻住 转  住住拽转 拽转?')) {
        wins = 0;
        losses = 0;
        coins = 0;
        currentStage = 0;
        saveLocalStats();
        updateStatsDisplay();
        updateCoinsDisplay();
        stageDisplay.textContent = currentStage + 1;
        message.textContent = '住住拽转 驻住 爪!';
        message.style.color = 'green';
        setTimeout(() => message.textContent = '', 3000);
      }
    }

    // --- 拽转 砖拽 注拽专转 ---

    function initializeGame() {
      mistakes = 0;
      totalMistakesInRound = 0;
      guessedLetters = [];
      hangmanImage.src = 'hangman0.png';
      message.textContent = '';
      playAgainButton.style.display = 'none';
      alphabetContainer.innerHTML = '';
      currentWord = getRandomWord(currentStage); // 拽  砖 

      if (!currentWord) {
        message.textContent = '专  砖 ! 注专 砖 .';
        message.style.color = 'orange';
        currentStage++;
        if (currentStage >= wordList.length) {
          message.textContent = '住转 转  砖! 转 转.';
          currentStage = 0; // 转 砖 专砖  住 转 
        }
        setTimeout(initializeGame, 2000); // 转 砖拽 砖 专 注
        return;
      }
      displayWord();
      createAlphabetButtons();
      stageDisplay.textContent = currentStage + 1;
      saveLocalStats(); // 砖专 住住拽转 专 转
    }

    function getRandomWord(stageIndex) {
      if (wordList.length === 0 || stageIndex >= wordList.length) {
        return null; //    砖  拽
      }
      const stageWords = wordList[stageIndex].words;
      if (stageWords.length === 0) return null;
      const randomIndex = Math.floor(Math.random() * stageWords.length);
      return stageWords[randomIndex];
    }

    function displayWord() {
      const display = currentWord.split('').map(letter => {
        if (letter === ' ') return '&nbsp;'; // 砖专 注 专
        return guessedLetters.includes(letter) ? letter : '_';
      }).join(' ');
      wordDisplay.innerHTML = display;
    }

    function createAlphabetButtons() {
      const alphabet = '住注驻爪拽专砖转';
      alphabetContainer.innerHTML = ''; // 拽 驻转专 拽
      alphabet.split('').forEach(letter => {
        const button = document.createElement('button');
        button.textContent = letter;
        button.classList.add('letter-button');
        button.addEventListener('click', () => handleGuess(letter, button));
        alphabetContainer.appendChild(button);
      });
    }

    function handleGuess(letter, button) {
      button.disabled = true; // 专 转 驻转专
      if (currentWord.includes(letter)) {
        guessedLetters.push(letter);
        displayWord();
        message.textContent = '!';
        message.style.color = 'green';
        if (!wordDisplay.textContent.includes('_')) {
          winGame();
        }
      } else {
        mistakes++;
        totalMistakesInRound++;
        hangmanImage.src = `hangman${mistakes}.png`;
        message.textContent = '注转!';
        message.style.color = 'red';
        if (mistakes >= maxMistakes) {
          loseGame();
        }
      }
    }

    function winGame() {
      message.textContent = ` ! 爪转!  转: ${currentWord}`;
      message.style.color = 'blue';
      disableAlphabetButtons();
      playAgainButton.style.display = 'block';
      updateCoins(10); // 住祝 10 注转 爪
      wins++;
      currentStage++; // 注专 砖 
      saveLocalStats(); // 砖专 住住拽转
    }

    function loseGame() {
      message.textContent = `祝! 驻住转.  转: ${currentWord}`;
      message.style.color = 'darkred';
      disableAlphabetButtons();
      playAgainButton.style.display = 'block';
      updateCoins(-5); // 专 5 注转 注 驻住
      losses++;
      saveLocalStats(); // 砖专 住住拽转
    }

    function disableAlphabetButtons() {
      Array.from(alphabetContainer.children).forEach(button => {
        button.disabled = true;
      });
    }

    // ---  住 专注 ---

    // 驻拽爪转 爪转 驻住 住/专砖 (驻拽爪转 UI ,  拽转 Firebase)
    function showLoginForm() {
      loginForm.style.display = 'block';
      signupForm.style.display = 'none';
    }

    function showSignupForm() {
      loginForm.style.display = 'none';
      signupForm.style.display = 'block';
    }

    function closeAuthBanner() {
      authOverlay.style.display = 'none';
    }

    // --- 驻 专注 (Event Listeners) ---

    // 驻拽爪转 专拽转 拽专 砖爪 爪 专转 砖住专 Firebase
    //   拽转 砖 砖 砖 转 Firebase 注转  转专爪
    loginSubmitButton.addEventListener('click', (event) => {
        event.preventDefault(); // 注 专注 祝
        alert('驻拽爪转 转专转   专注 (驻专住 转拽).');
        console.log('Login attempt:', loginEmailInput.value, loginPasswordInput.value);
    });

    signupSubmitButton.addEventListener('click', (event) => {
        event.preventDefault(); // 注 专注 祝
        alert('驻拽爪转 专砖   专注 (驻专住 转拽).');
        console.log('Signup attempt:', signupEmailInput.value, signupPasswordInput.value);
    });

    logoutButton.addEventListener('click', () => {
        alert('驻拽爪转 转转拽转   专注 (驻专住 转拽).');
        user = null;
        usernameDisplay.textContent = '专';
        logoutButton.style.display = 'none';
        startScreen.style.display = 'flex';
        gameContainer.style.display = 'none';
        welcomeBanner.classList.remove('hide');
        // 砖专 转 注转 拽转  砖,  驻住 转  专爪 转转拽转 
        // coins = 0; updateCoinsDisplay();
    });

    // 驻转专  住 砖拽
    playAgainButton.addEventListener('click', initializeGame);
    newGameButton.addEventListener('click', () => {
      startScreen.style.display = 'none';
      gameContainer.style.display = 'block';
      initializeGame();
    });

    loginButton.addEventListener('click', () => {
        welcomeBanner.classList.add('hide');
        startScreen.style.display = 'none';
        authOverlay.style.display = 'block';
        showLoginForm(); // 爪 驻住 转专转
    });

    continueWithoutLoginButton.addEventListener('click', () => {
      welcomeBanner.classList.add('hide');
      startScreen.style.display = 'flex'; //  砖住 转 
      authOverlay.style.display = 'none';
      gameContainer.style.display = 'none'; // 住转专 转 砖拽 转
      user = { uid: 'anonymous_local' }; // 住爪 砖 砖转砖 专
      usernameDisplay.textContent = '砖转砖 专';
      logoutButton.style.display = 'none'; //  爪 驻转专 转转拽转 专
      loadLocalStats(); // 注 住住拽转 拽转 注专 专
    });

    signupLink.addEventListener('click', (e) => {
      e.preventDefault();
      showSignupForm();
    });

    showLoginFormLink.addEventListener('click', (e) => {
      e.preventDefault();
      showLoginForm();
    });

    showSignupFormLink.addEventListener('click', (e) => {
      e.preventDefault();
      showSignupForm();
    });

    closeAuthButton.addEventListener('click', closeAuthBanner);
    showStatsButton.addEventListener('click', () => {
      loadLocalStats(); //  注转 住住拽转 注转
      gameStatsOverlay.style.display = 'block';
    });
    closeStatsButton.addEventListener('click', () => {
      gameStatsOverlay.style.display = 'none';
    });
    resetStatsButton.addEventListener('click', resetLocalStats);

    // --- 转 专砖 注转 注转 祝 ---
    // 转专 注 注 专 驻转 住专 住拽专 住转专
    //  爪 专 注转 .
    // 拽 砖爪 转 -body 注 (visibility: visible) 驻注 转 -fetch.
    // 专注 转 转爪注 专拽 转 -fetch -stages.json
  </script>
</body>
</html>